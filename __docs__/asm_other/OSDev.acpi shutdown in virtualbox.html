<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-gb" xml:lang="en-gb">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta http-equiv="content-language" content="en-gb" />
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="imagetoolbar" content="no" />
<meta name="resource-type" content="document" />
<meta name="distribution" content="global" />
<meta name="copyright" content="2000, 2002, 2005, 2007 phpBB Group" />
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />

<title>OSDev.org &bull; View topic - acpi shutdown in virtualbox</title>

<link rel="alternate" type="application/atom+xml" title="Feed - OSDev.org" href="http://f.osdev.org/feed.php" /><link rel="alternate" type="application/atom+xml" title="Feed - News" href="http://f.osdev.org/feed.php?mode=news" /><link rel="alternate" type="application/atom+xml" title="Feed - All forums" href="http://f.osdev.org/feed.php?mode=forums" /><link rel="alternate" type="application/atom+xml" title="Feed - New Topics" href="http://f.osdev.org/feed.php?mode=topics" /><link rel="alternate" type="application/atom+xml" title="Feed - Active Topics" href="http://f.osdev.org/feed.php?mode=topics_active" /><link rel="alternate" type="application/atom+xml" title="Feed - Forum - OS Development" href="http://f.osdev.org/feed.php?f=1" /><link rel="alternate" type="application/atom+xml" title="Feed - Topic - acpi shutdown in virtualbox" href="http://f.osdev.org/feed.php?f=1&amp;t=30834" />

<link rel="stylesheet" href="./styles/subsilver2/theme/stylesheet.css" type="text/css" />

<script type="text/javascript">
// <![CDATA[


function popup(url, width, height, name)
{
	if (!name)
	{
		name = '_popup';
	}

	window.open(url.replace(/&amp;/g, '&'), name, 'height=' + height + ',resizable=yes,scrollbars=yes,width=' + width);
	return false;
}

function jumpto()
{
	var page = prompt('Enter the page number you wish to go to:', '1');
	var per_page = '';
	var base_url = '';

	if (page !== null && !isNaN(page) && page == Math.floor(page) && page > 0)
	{
		if (base_url.indexOf('?') == -1)
		{
			document.location.href = base_url + '?start=' + ((page - 1) * per_page);
		}
		else
		{
			document.location.href = base_url.replace(/&amp;/g, '&') + '&start=' + ((page - 1) * per_page);
		}
	}
}

/**
* Find a member
*/
function find_username(url)
{
	popup(url, 760, 570, '_usersearch');
	return false;
}

/**
* Mark/unmark checklist
* id = ID of parent container, name = name prefix, state = state [true/false]
*/
function marklist(id, name, state)
{
	var parent = document.getElementById(id);
	if (!parent)
	{
		eval('parent = document.' + id);
	}

	if (!parent)
	{
		return;
	}

	var rb = parent.getElementsByTagName('input');
	
	for (var r = 0; r < rb.length; r++)
	{
		if (rb[r].name.substr(0, name.length) == name)
		{
			rb[r].checked = state;
		}
	}
}



// ]]>
</script>
</head>
<body class="ltr">

<a name="top"></a>

<div id="wrapheader">

	<div id="logodesc">
		<table width="100%" cellspacing="0">
		<tr>
			<td><a href="./index.php?sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/osdev.png" width="120" height="100" alt="" title="" /></a></td>
			<td width="100%" align="center"><h1>OSDev.org</h1><span class="gen">The Place to Start for Operating System Developers</span></td>
		</tr>
		</table>
	</div>

	<div id="menubar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="genmed">
				<a href="./ucp.php?mode=login&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/theme/images/icon_mini_login.gif" width="12" height="13" alt="*" /> Login</a>&nbsp; &nbsp;<a href="./ucp.php?mode=register&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/theme/images/icon_mini_register.gif" width="12" height="13" alt="*" /> Register</a>
					
			</td>
			<td class="genmed" align="right">
<a href="http://wiki.osdev.org/" style="font-size: 125%; font-weight: bold;">The OSDev.org Wiki - Got a question? Search this first!</a>
				<a href="./faq.php?sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/theme/images/icon_mini_faq.gif" width="12" height="13" alt="*" /> FAQ</a>
				&nbsp; &nbsp;<a href="./search.php?sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/theme/images/icon_mini_search.gif" width="12" height="13" alt="*" /> Search</a>
			</td>
		</tr>
		</table>
	</div>

	<div id="datebar">
		<table width="100%" cellspacing="0">
		<tr>
			<td class="gensmall"></td>
			<td class="gensmall" align="right">It is currently Tue Sep 27, 2016 10:52 am<br /></td>
		</tr>
		</table>
	</div>

</div>

<div id="wrapcentre">

	
	<p class="searchbar">
		<span style="float: left;"><a href="./search.php?search_id=unanswered&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">View unanswered posts</a> | <a href="./search.php?search_id=active_topics&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">View active topics</a></span>
		
	</p>
	

	<br style="clear: both;" />

	<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=fdc8c76715367abfb73a04dcd164a8ac">Board index</a> &#187; <a href="./viewforum.php?f=16&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Operating System Development</a> &#187; <a href="./viewforum.php?f=1&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">OS Development</a></p>
			<p class="datetime">All times are UTC - 6 hours </p>
		</td>
	</tr>
	</table>

	<br />

<div id="pageheader">
	<h2><a class="titles" href="./viewtopic.php?f=1&amp;t=30834&amp;start=0&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">acpi shutdown in virtualbox</a></h2>


	<p class="moderators">Moderators: <a href="./memberlist.php?mode=viewprofile&amp;u=3016&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">mystran</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=67&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">JAAman</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=4866&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Owen</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=1906&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Combuster</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=1922&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">quok</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=2600&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">os64dev</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=1902&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Candy</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=2&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">chase</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=2477&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">pcmattman</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=12891&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">sortie</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=1950&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">AJ</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=356&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Brendan</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=3731&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">01000101</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=155&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">carbonBased</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=13448&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Antti</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=4287&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">thepowersgang</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=3781&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">JamesM</a>, <a href="./memberlist.php?mode=viewprofile&amp;u=117&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">kmcguire</a></p>

</div>

<br clear="all" /><br />

<div id="pagecontent">

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=1&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=1&amp;t=30834&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 8 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat">
			<table width="100%" cellspacing="0">
			<tr>
				<td class="nav" nowrap="nowrap">&nbsp;
				<a href="./viewtopic.php?f=1&amp;t=30834&amp;start=0&amp;sid=fdc8c76715367abfb73a04dcd164a8ac&amp;view=print" title="Print view">Print view</a>
				</td>
				<td class="nav" align="right" nowrap="nowrap"><a href="./viewtopic.php?f=1&amp;t=30834&amp;view=previous&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Previous topic</a> | <a href="./viewtopic.php?f=1&amp;t=30834&amp;view=next&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Next topic</a>&nbsp;</td>
			</tr>
			</table>
		</td>
	</tr>

	</table>


	<table class="tablebg" width="100%" cellspacing="1">
	
		<tr>
			<th>Author</th>
			<th>Message</th>
		</tr>
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p265522"></a>
				<b class="postauthor">poby</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265522&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265522"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 21, 2016 9:44 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Sep 21, 2016 9:39 am<br /><b>Posts:</b> 3
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I am running a custom os in virtualbox and have parsed the ACPI, FACP, DSDT etc tables to get the PM1a_CNT and SLP_TYPa values. These seem to be correct. However when I try to do an ACPI shutdown with:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">xor eax, eax<br />mov edx, &#91;PM1a_CNT&#93;<br />mov ax, &#91;SLP_TYPa&#93;<br />or ax, (1 shl 13)<br />out dx, ax </div><br />Nothing happens. PM1a_CNT is 0x4004 and SLP_TYPa is 0, which seems reasonable compared to other values I have seen elsewhere. I also check PM1b_CNT which is zero so I don't bother with it.<br /><br />Is there an issue or trick with virtualbox to get it working?<br /><br />Also, when trying to acpi shutdown from the virtualbox menu, it says it's not supported in this guest.<br /><br />Has anyone successfully implemented acpi shutdown in their os running under virtualbox?</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17230&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p265528"></a>
				<b class="postauthor">mariuszp</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> Re: acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265528&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265528"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 21, 2016 11:03 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Member</td>
				</tr>
			
				<tr>
					<td><img src="./images/ranks/4.gif" alt="Member" title="Member" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=11130_1307223906.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Oct 16, 2010 3:38 pm<br /><b>Posts:</b> 429
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">poby wrote:</div><div class="quotecontent">I am running a custom os in virtualbox and have parsed the ACPI, FACP, DSDT etc tables to get the PM1a_CNT and SLP_TYPa values. These seem to be correct. However when I try to do an ACPI shutdown with:<br /><br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">xor eax, eax<br />mov edx, &#91;PM1a_CNT&#93;<br />mov ax, &#91;SLP_TYPa&#93;<br />or ax, (1 shl 13)<br />out dx, ax </div><br />Nothing happens. PM1a_CNT is 0x4004 and SLP_TYPa is 0, which seems reasonable compared to other values I have seen elsewhere. I also check PM1b_CNT which is zero so I don't bother with it.<br /><br />Is there an issue or trick with virtualbox to get it working?<br /><br />Also, when trying to acpi shutdown from the virtualbox menu, it says it's not supported in this guest.<br /><br />Has anyone successfully implemented acpi shutdown in their os running under virtualbox?</div><br />Mine works, but i use ACPICA instead of implementing it manually</div>

					
						<span class="postbody"><br />_________________<br />Glidix: An x86_64 POSIX-compliant operating system, aiming to be as optimized as possible, especially in graphics.<br /><!-- m --><a class="postlink" href="https://github.com/madd-games/glidix">https://github.com/madd-games/glidix</a><!-- m --></span>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=11130&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p265529"></a>
				<b class="postauthor">omarrx024</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> Re: acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265529&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265529"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 21, 2016 12:34 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Member</td>
				</tr>
			
				<tr>
					<td><img src="./images/ranks/4.gif" alt="Member" title="Member" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sat Dec 27, 2014 9:11 am<br /><b>Posts:</b> 618<br /><b>Location:</b> Cairo, Egypt
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">It's most likely you followed the Wiki on how to do an ACPI shutdown, didn't you?<br />The information on there is inaccurate, and I had similar problems until I read the relevant parts of the ACPI specification. Maybe someone could help me fix the Wiki entry on shutdown?<br />Anyway, the Wiki doesn't mention that the sleep objects may be in the SSDT and not nescessarily the DSDT (although on VirtualBox, it is in the DSDT.) The DSDT/SSDT as already mentioned on the Wiki is AML-encoded. The system shutdown really is the _S5_ sleep state, encoded in the _S5_ package object. You can scan the DSDT/SSDT for &quot;_S5_&quot; (without a null terminator) followed by the byte value 0x12 (which really is the AML opcode for package.) An AML package is a collection of other data. In the case of _S5_, the package contains 4 integers. The first integer is the SLP_TYPa value, and the second is the SLP_TYPb value. The integers may be bytes, words, DWORDs or QWORDs, although in the case of _S5_ they will always be bytes. In a pointer to the start of the _S5_ package, add 7 and read a byte from there and increment the pointer. If it is 0x0A (AML opcode for byte prefix), then the byte it now points to is the SLP_TYPa value. If not, take the read byte as the SLP_TYPa value. Repeat with the already-incremented pointer, but for the SLP_TYPb value. Ignore the remaining two values; they are reserved. AND both SLP_TYPa and SLP_TYPb values by 7 to clear all bits except the lowest three.<br />Now, the Wiki says you OUT the SLP_TYPa/b to the PM1a/b control block I/O ports. What the Wiki doesn't mention is that you have to shift them to the left by 10 bits. In general, after you've acquired the sleep values, you shut down like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">uint16_t tmp = inw(fadt-&gt;pm1a_control_block);<br />outw(fadt-&gt;pm1a_control_block, tmp | (uint16_t)slp_typa &lt;&lt; 10) | 0x2000);<br />if(fadt-&gt;pm1b_control_block == 0)<br />{<br />&nbsp; &nbsp;panic(&quot;Shutdown failed...&quot;);<br />}<br />tmp = inw(fadt-&gt;pm1b_control_block);<br />outw(fadt-&gt;pm1b_control_block, tmp | (uint16_t)slp_typb &lt;&lt; 10) | 0x2000);<br /></div><br />Something you shouldn't depend on: on VirtualBox, the SLP_TYPa value is 5, and there is a byte prefix opcode before the byte value 5.<br /><span style="font-weight: bold">EDIT:</span><br />I've just noticed you mention the ACPI shutdown menu item on VirtualBox says unsupported on the guest. This means you have not even enabled ACPI. Do something like this:<br /><div class="codetitle"><b>Code:</b></div><div class="codecontent">outb(fadt-&gt;sci_command, fadt-&gt;acpi_enable);</div><br />And put a short delay, then check if bit 0 of PM1a_CONTROL_BLOCK sets. If it doesn't set after a short delay (maybe a few milliseconds?), then you should fail and consider the firmware to be not responding. A shutdown won't work without enabling the ACPI firmware.<br />Oh, and that shutdown menu really generates a SCI IRQ, and you'll need an IRQ handler for that too and a complete AML interpreter.<br /><a href="https://github.com/omarrx024/xos/blob/master/kernel/firmware/acpirun.asm" class="postlink">My homemade ACPI DSDT/SSDT scanner and sleep/shutdown code.</a></div>

					
						<span class="postbody"><br />_________________<br />Byte me; <a href="https://github.com/omarrx024/xos" class="postlink">my OS</a>.<br /><span style="font-style: italic">Aspire to inspire before we expire.</span></span>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=15866&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p265533"></a>
				<b class="postauthor">jnc100</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> Re: acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265533&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265533"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 21, 2016 1:06 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Member</td>
				</tr>
			
				<tr>
					<td><img src="./images/ranks/4.gif" alt="Member" title="Member" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Mon Apr 09, 2007 12:10 pm<br /><b>Posts:</b> 764<br /><b>Location:</b> London, UK
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Yes, for VirtualBox you can write (((5 &amp; 7) &lt;&lt; 10) | (1 &lt;&lt; 13)) to io port 0x4004 as a 16-bit write.<br /><br />However, any code which scans the dsdt/ssdt for _S5 and a package object is very fragile.  There is nothing to specify that _S5 has to be a data object.  It can just as easily be a method _S5() which returns the actual package object.<br /><br />In addition, you are expected to execute _PTS(5) and then _GTS(5) before doing the write to PM1a/b_CNT.<br /><br />All-in-all, attempting to do it without a proper AML interpreter (e.g. ACPICA) will result in a system that luckily happens to work on some systems but will likely cause many issues on others.<br /><br />Regards,<br />John.</div>

					
						<span class="postbody"><br />_________________<br /><a href="http://www.tysos.org" class="postlink">Tysos</a> | <a href="https://github.com/jncronin/rpi-boot" class="postlink">rpi-boot</a> | <a href="http://www.tysos.org/redmine/projects/tysos/wiki/EFI" class="postlink">EFI tools</a></span>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=3445&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p265548"></a>
				<b class="postauthor">poby</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> Re: acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265548&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265548"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Wed Sep 21, 2016 10:53 pm&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Sep 21, 2016 9:39 am<br /><b>Posts:</b> 3
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">Huge thanks to you guys!  Got it working now. I wish the wiki was updated with this sort of info.<br /><br />I'm doing a brute force scan through the DSDT to find the &quot;_S5_&quot; string as I've heard there's only one in there.  But I might look into programming an AML parser if, as seems likely, I might want to use other values later.  All in assembly <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" />  Because (it's fun) | (I'm a masochist)</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17230&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p265556"></a>
				<b class="postauthor">SpyderTL</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> Re: acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265556&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265556"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 22, 2016 4:03 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Member</td>
				</tr>
			
				<tr>
					<td><img src="./images/ranks/4.gif" alt="Member" title="Member" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=11075_1467060212.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2010 10:05 pm<br /><b>Posts:</b> 816
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody"><div class="quotetitle">poby wrote:</div><div class="quotecontent">Also, when trying to acpi shutdown from the virtualbox menu, it says it's not supported in this guest.<br /><br />Has anyone successfully implemented acpi shutdown in their os running under virtualbox?</div><br /><br />You can set the system power to the _S5_ state any time you want by using the &quot;shortcut&quot; that you are using now.<br /><br />However, if you want the system to respond to the user pressing the power (or sleep) button, or if you want to know when the user of a laptop closes the lid, then you will need a full AML interpreter, because the code to notify the system which of these events you want to receive is written in AML, and it is located in the ACPI tables.  This is why the shutdown button in VirtualBox does not currently work in your OS, because you haven't notified the system that your OS supports receiving shutdown events.<br /><br />Congrats on the working shutdown, by the way. This is the same method I'm currently using, and getting a physical machine to shut itself off is one of my proudest osdev moments.  <img src="./images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>

					
						<span class="postbody"><br />_________________<br />Project: OZone<br /><a href="https://ozone.codeplex.com" class="postlink">CodePlex</a> / <a href="https://github.com/SpyderTL/OZone" class="postlink">GitHub</a><br /><br />&quot;The more they overthink the plumbing, the easier it is to stop up the drain.&quot; - Montgomery Scott</span>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=11075&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row1">

			<td align="center" valign="middle">
				<a name="p265561"></a>
				<b class="postauthor">poby</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> Re: acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265561&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265561"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 22, 2016 6:07 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Wed Sep 21, 2016 9:39 am<br /><b>Posts:</b> 3
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I assume _PTS and _GTS are in the DSDT, but I'm having trouble finding any information about them.  The spec is so long and frankly more than a little overwhelming, it would be great to get a brief synopsis of what these methods do and the record format.</div>

					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row1">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=17230&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table class="tablebg" width="100%" cellspacing="1">
	<tr class="row2">

			<td align="center" valign="middle">
				<a name="p265577"></a>
				<b class="postauthor">SpyderTL</b>
			</td>
			<td width="100%" height="25">
				<table width="100%" cellspacing="0">
				<tr>
				
					<td class="gensmall" width="100%"><div style="float: left;">&nbsp;<b>Post subject:</b> Re: acpi shutdown in virtualbox</div><div style="float: right;"><a href="./viewtopic.php?p=265577&amp;sid=fdc8c76715367abfb73a04dcd164a8ac#p265577"><img src="./styles/subsilver2/imageset/icon_post_target.gif" width="12" height="9" alt="Post" title="Post" /></a><b>Posted:</b> Thu Sep 22, 2016 10:12 am&nbsp;</div></td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td valign="top" class="profile">
				<table cellspacing="4" align="center" width="150">
			
				<tr>
					<td><img src="./styles/subsilver2/imageset/en/icon_user_offline.gif" alt="Offline" title="Offline" /></td>
				</tr>
			
				<tr>
					<td class="postdetails">Member</td>
				</tr>
			
				<tr>
					<td><img src="./images/ranks/4.gif" alt="Member" title="Member" /></td>
				</tr>
			
				<tr>
					<td><img src="./download/file.php?avatar=11075_1467060212.png" width="80" height="80" alt="User avatar" /></td>
				</tr>
			
				</table>

				<span class="postdetails">
					<br /><b>Joined:</b> Sun Sep 19, 2010 10:05 pm<br /><b>Posts:</b> 816
				</span>

			</td>
			<td valign="top">
				<table width="100%" cellspacing="5">
				<tr>
					<td>
					

						<div class="postbody">I found a pretty good summary here: <!-- m --><a class="postlink" href="http://www.advogato.org/article/913.html">http://www.advogato.org/article/913.html</a><!-- m --><br /><br />PTS and GTS are functions provided by the system, written in AML, that you can (should) execute whenever the OS decides to put the system to sleep.  Your AML interpreter (that you write) simply executes the code in these two functions.</div>

					
						<span class="postbody"><br />_________________<br />Project: OZone<br /><a href="https://ozone.codeplex.com" class="postlink">CodePlex</a> / <a href="https://github.com/SpyderTL/OZone" class="postlink">GitHub</a><br /><br />&quot;The more they overthink the plumbing, the easier it is to stop up the drain.&quot; - Montgomery Scott</span>
					<br clear="all" /><br />

						<table width="100%" cellspacing="0">
						<tr valign="middle">
							<td class="gensmall" align="right">
							
							</td>
						</tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
		</tr>

		<tr class="row2">

			<td class="profile"><strong><a href="#wrapheader">Top</a></strong></td>
			<td><div class="gensmall" style="float: left;">&nbsp;<a href="./memberlist.php?mode=viewprofile&amp;u=11075&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/icon_user_profile.gif" alt="Profile" title="Profile" /></a> &nbsp;</div> <div class="gensmall" style="float: right;">&nbsp;</div></td>
	
		</tr>

	<tr>
		<td class="spacer" colspan="2" height="1"><img src="images/spacer.gif" alt="" width="1" height="1" /></td>
	</tr>
	</table>

	<table width="100%" cellspacing="1" class="tablebg">
	<tr align="center">
		<td class="cat"><form name="viewtopic" method="post" action="./viewtopic.php?f=1&amp;t=30834&amp;start=0&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><span class="gensmall">Display posts from previous:</span> <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select>&nbsp;<span class="gensmall">Sort by</span> <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select> <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select>&nbsp;<input class="btnlite" type="submit" value="Go" name="sort" /></form></td>
	</tr>
	</table>
	

	<table width="100%" cellspacing="1">
	<tr>
		<td align="left" valign="middle" nowrap="nowrap">
		<a href="./posting.php?mode=post&amp;f=1&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/button_topic_new.gif" alt="Post new topic" title="Post new topic" /></a>&nbsp;<a href="./posting.php?mode=reply&amp;f=1&amp;t=30834&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><img src="./styles/subsilver2/imageset/en/button_topic_reply.gif" alt="Reply to topic" title="Reply to topic" /></a>
		</td>
		
			<td class="nav" valign="middle" nowrap="nowrap">&nbsp;Page <strong>1</strong> of <strong>1</strong><br /></td>
			<td class="gensmall" nowrap="nowrap">&nbsp;[ 8 posts ]&nbsp;</td>
			<td class="gensmall" width="100%" align="right" nowrap="nowrap"></td>
		
	</tr>
	</table>

</div>

<div id="pagefooter"></div>

<br clear="all" />
<table class="tablebg" width="100%" cellspacing="1" cellpadding="0" style="margin-top: 5px;">
	<tr>
		<td class="row1">
			<p class="breadcrumbs"><a href="./index.php?sid=fdc8c76715367abfb73a04dcd164a8ac">Board index</a> &#187; <a href="./viewforum.php?f=16&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Operating System Development</a> &#187; <a href="./viewforum.php?f=1&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">OS Development</a></p>
			<p class="datetime">All times are UTC - 6 hours </p>
		</td>
	</tr>
	</table>
	<br clear="all" />

	<table class="tablebg" width="100%" cellspacing="1">
	<tr>
		<td class="cat"><h4>Who is online</h4></td>
	</tr>
	<tr>
		<td class="row1"><p class="gensmall">Users browsing this forum: <a href="./memberlist.php?mode=viewprofile&amp;u=17107&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">BasdP</a>, <span style="color: #9E8DA7;" class="username-coloured">Bing [Bot]</span>, <a href="./memberlist.php?mode=viewprofile&amp;u=1899&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">Brynet-Inc</a>, <span style="color: #9E8DA7;" class="username-coloured">Google [Bot]</span>, <a href="./memberlist.php?mode=viewprofile&amp;u=16786&amp;sid=fdc8c76715367abfb73a04dcd164a8ac">hoppecl</a> and 9 guests</p></td>
	</tr>
	</table>


<br clear="all" />

<table width="100%" cellspacing="1">
<tr>
	<td width="40%" valign="top" nowrap="nowrap" align="left"></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="gensmall">You <strong>cannot</strong> post new topics in this forum<br />You <strong>cannot</strong> reply to topics in this forum<br />You <strong>cannot</strong> edit your posts in this forum<br />You <strong>cannot</strong> delete your posts in this forum<br />You <strong>cannot</strong> post attachments in this forum<br /></span></td>
</tr>
</table>

<br clear="all" />

<table width="100%" cellspacing="0">
<tr>
	<td><form method="post" name="search" action="./search.php?t=30834&amp;sid=fdc8c76715367abfb73a04dcd164a8ac"><span class="gensmall">Search for:</span> <input class="post" type="text" name="keywords" size="20" /> <input class="btnlite" type="submit" value="Go" /></form></td>
	<td align="right">
	<form method="post" name="jumpbox" action="./viewforum.php?sid=fdc8c76715367abfb73a04dcd164a8ac" onsubmit="if(document.jumpbox.f.value == -1){return false;}">

	<table cellspacing="0" cellpadding="0" border="0">
	<tr>
		<td nowrap="nowrap"><span class="gensmall">Jump to:</span>&nbsp;<select name="f" onchange="if(this.options[this.selectedIndex].value != -1){ document.forms['jumpbox'].submit() }">

		
			<option value="-1">Select a forum</option>
		<option value="-1">------------------</option>
			<option value="16">Operating System Development</option>
		
			<option value="1" selected="selected">&nbsp; &nbsp;OS Development</option>
		
			<option value="15">&nbsp; &nbsp;OS Design &amp; Theory</option>
		
			<option value="2">&nbsp; &nbsp;Announcements, Test Requests, &amp; Job openings</option>
		
			<option value="17">Everything Else</option>
		
			<option value="13">&nbsp; &nbsp;General Programming</option>
		
			<option value="11">&nbsp; &nbsp;General Ramblings</option>
		
			<option value="7">&nbsp; &nbsp;Auto-Delete Forum</option>
		
			<option value="18">OSDev.org</option>
		
			<option value="8">&nbsp; &nbsp;OSDev Wiki</option>
		
			<option value="6">&nbsp; &nbsp;About this site</option>
		

		</select>&nbsp;<input class="btnlite" type="submit" value="Go" /></td>
	</tr>
	</table>

	</form>
</td>
</tr>
</table>


</div>

<!--
	We request you retain the full copyright notice below including the link to www.phpbb.com.
	This not only gives respect to the large amount of time given freely by the developers
	but also helps build interest, traffic and use of phpBB3. If you (honestly) cannot retain
	the full copyright we ask you at least leave in place the "Powered by phpBB" line, with
	"phpBB" linked to www.phpbb.com. If you refuse to include even this then support on our
	forums may be affected.

	The phpBB Group : 2006
//-->

<div id="wrapfooter">
	
	<span class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a> &copy; 2000, 2002, 2005, 2007 phpBB Group
	</span>
</div>

</body>
</html>